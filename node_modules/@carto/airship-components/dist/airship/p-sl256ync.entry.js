import{r as t,c as s,h as i,H as e}from"./p-3fce0d94.js";import{i as a}from"./p-50e02719.js";import{t as h,u as r,l as o,e as n}from"./p-3374c455.js";import{D as l,a as c,A as d,b as m,c as p}from"./p-2231320f.js";const u=class{constructor(i){t(this,i),this.showHeader=!0,this.disableInteractivity=!1,this.data=[],this.backgroundData=[],this.color=l,this.unselectedColor=c,this.isLoading=!1,this.error="",this.errorDescription="",this.noDataHeaderMessage="NO DATA AVAILABLE",this.noDataBodyMessage="There is no data to display.",this.responsive=!0,this.progress=0,this.playing=!1,this.animated=!1,this.timeFormat=d,this.clearText="Clear selection",this.range=null,this.disableAnimation=!1,this.xAxisOptions={},this.yAxisOptions={},this.axisFormatter=this.axisFormatter.bind(this),this.play=s(this,"play",7),this.pause=s(this,"pause",7),this.selectionChanged=s(this,"selectionChanged",7),this.seek=s(this,"seek",7)}onDataChanged(t,s){(function(t,s){if(t.length!==s.length)return!1;for(let i=0;i<t.length;i++)if(t[i].start!==s[i].start||t[i].end!==s[i].end||t[i].value!==s[i].value||t[i].color!==s[i].color)return!1;return!0})(t,s)||(this.timeFormat=this.timeFormat===d?"number"==typeof this.data[0].start?m:p:this.timeFormat)}onBackgroundDataChanged(t){this._backgroundData=t}onProgressChanged(){this._render()}onTimeFormatChanged(t){this._formatter=h(t),this.histogram&&this.histogram.forceUpdate()}onTimeFormatLocaleChanged(t){try{r(t),this.timeFormat&&this.onTimeFormatChanged(this.timeFormat)}catch(t){throw new Error("Invalid time format.")}}async defaultFormatter(t){return this.histogram.defaultFormatter(t)}async getSelection(){return this.histogram.getSelection()}async setSelection(t){this.histogram.setSelection(t)}async clearSelection(){this.histogram.clearSelection()}async xFormatter(t){return this.histogram.xFormatter(t)}async componentWillLoad(){this.onDataChanged(this.data,[]),this.onBackgroundDataChanged(this.backgroundData)}async componentDidLoad(){this.timeFormatLocale&&r(this.timeFormatLocale),this._formatter=h(this.timeFormat),this.histogram.addEventListener("selectionInput",t=>{this._selection=null===t.detail?null:t.detail.selection,this._render()}),this.histogram.addEventListener("selectionChanged",t=>{t.stopPropagation(),null!==t.detail?(this.selectionChanged.emit(t.detail.selection),this._render()):this.selectionChanged.emit(null)}),this.histogram.addEventListener("drawParametersChanged",t=>{this._renderOptions=t.detail,this._render()}),this._selection=await this.histogram.getSelection()}render(){return i(e,{class:{"as-time-series--animated":this.animated}},this._renderButton(),i("as-histogram-widget",{ref:t=>{this.histogram=t},heading:this.heading,description:this.description,showHeader:this.showHeader,showClear:this.showClear,disableInteractivity:this.disableInteractivity,data:this.data,backgroundData:this._backgroundData,color:this.color,unselectedColor:this.unselectedColor,colorRange:this.colorRange,axisFormatter:this.axisFormatter,tooltipFormatter:this.tooltipFormatter||this._tooltipFormatter.bind(this),xLabel:this.xLabel,yLabel:this.yLabel,isLoading:this.isLoading,error:this.error,errorDescription:this.errorDescription,noDataHeaderMessage:this.noDataHeaderMessage,noDataBodyMessage:this.noDataBodyMessage,responsive:this.responsive,clearText:this.clearText,range:this.range,disableAnimation:this.disableAnimation,xAxisOptions:this.xAxisOptions,yAxisOptions:this.yAxisOptions}))}axisFormatter(t){return this._formatter(t)}_tooltipFormatter(t){return[`${this.axisFormatter(t.start)} - ${this.axisFormatter(t.end)}`,`${t.value}`]}_renderButton(){return this.animated?i("div",{class:{"as-time-series--play-button":!0,"as-time-series--play-button-hidden":!this.data.length||this.isLoading||!!this.error,"as-time-series--play-button-x-label":!!this.xLabel},onClick:this._playPauseClick.bind(this)},a(this.playing?"PAUSE":"PLAY","var(--as--color--primary)",{width:"32px",height:"32px"})):null}_playPauseClick(){this.playing?this.pause.emit():this.play.emit()}_render(){if(!this._renderOptions)return;const{container:t,height:s,width:i,padding:e,xScale:a,binsScale:h,handleWidth:r}=this._renderOptions;let l=t.select(".as-time-series--g");if(!this.animated)return void(l.empty()||l.remove());const{left:c}=t.node().getBoundingClientRect(),[d,m]=e,p=o().domain([0,100]);let u=0;if(this._selection){const t=this._selection.map(t=>a(h(t)));p.range([t[0]+(u=r/2)+3,t[1]-u-3])}else p.range([0,i-d]);const g=p(this.progress);t.on("click",()=>{const t=Math.round(p.invert(n.clientX-c-d+8));t>100||t<0||this.seek.emit(t)}),l.empty()&&((l=t.append("g").attr("class","as-time-series--g")).append("line").attr("class","as-time-series--preview").attr("stroke-width",4).attr("stroke","gray").attr("opacity","0"),l.append("line").attr("class","as-time-series--line").attr("stroke-width",4),l.append("circle").attr("class","as-time-series--scrubber").attr("r",6).attr("stroke-width",0),l.append("line").attr("class","as-time-series--track").attr("stroke-width",16).attr("stroke","black").attr("opacity","0").on("mouseleave",()=>{this._lastMousePosition=-1,l.select(".as-time-series--preview").attr("opacity","0")})),l.select(".as-time-series--line").attr("x1",p(0)-3).attr("x2",g).attr("y1",s-m).attr("y2",s-m),l.select(".as-time-series--track").attr("y1",s-m).attr("y2",s-m).attr("x1",p(0)+u).attr("x2",p(100)-u).on("mousemove",()=>{this._lastMousePosition=n.clientX-c-d+8,this._lastMousePosition>p(this.progress)&&l.select(".as-time-series--preview").attr("x2",this._lastMousePosition).attr("opacity","1")}),l.select(".as-time-series--preview").attr("x1",g-3).attr("y1",s-m).attr("y2",s-m).attr("opacity",()=>this._lastMousePosition>g?"1":"0"),l.select(".as-time-series--scrubber").attr("transform",`translate(${g-3},${s-m})`)}static get watchers(){return{data:["onDataChanged"],backgroundData:["onBackgroundDataChanged"],progress:["onProgressChanged"],timeFormat:["onTimeFormatChanged"],timeFormatLocale:["onTimeFormatLocaleChanged"]}}static get style(){return"as-time-series-widget{--as--time-series--line-color:var(--as--color--primary,#1785fb);--as-histogram-widget--background-color:var(--as--color--ui-01);display:-ms-flexbox;display:flex;-ms-flex-align:end;align-items:flex-end;height:100%;background:var(--as-histogram-widget--background-color,#fff)}as-time-series-widget as-histogram-widget{overflow:unset}as-time-series-widget.as-time-series--animated as-histogram-widget .content,as-time-series-widget.as-time-series--animated as-histogram-widget as-widget-header,as-time-series-widget.as-time-series--animated as-histogram-widget as-widget-selection{margin-left:-32px}as-time-series-widget .as-time-series--play-button{margin-bottom:2px;cursor:pointer}as-time-series-widget .as-time-series--play-button-hidden{opacity:0}as-time-series-widget .as-time-series--play-button-x-label{margin-bottom:27px}as-time-series-widget .as-time-series--line,as-time-series-widget .as-time-series--scrubber{stroke:var(--as--time-series--line-color);fill:var(--as--time-series--line-color)}as-time-series-widget .as-time-series--line,as-time-series-widget .as-time-series--scrubber,as-time-series-widget .as-time-series--track{cursor:pointer}"}};export{u as as_time_series_widget};