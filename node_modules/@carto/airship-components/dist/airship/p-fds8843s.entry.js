import{r as t,c as s,h as i,g as n}from"./p-3fce0d94.js";import{c as e}from"./p-e64a8f04.js";import{r}from"./p-b11b551f.js";import{s as h}from"./p-b283ec9e.js";import{e as o,s as a,v as l,w as u,x as c,y as f,l as d,z as p,A as g,B as m}from"./p-3374c455.js";import{d as w,i as y}from"./p-c73eaaa7.js";import{b as v,a as b}from"./p-87eae0eb.js";import{D as _,a as x,d as M,e as k}from"./p-2231320f.js";function C(){o.preventDefault(),o.stopImmediatePropagation()}function D(t){return function(){return t}}function S(t,s,i){this.target=t,this.type=s,this.selection=i}function $(){o.stopImmediatePropagation()}function A(){o.preventDefault(),o.stopImmediatePropagation()}var T={name:"drag"},j={name:"space"},z={name:"handle"},B={name:"center"};function L(t){return[+t[0],+t[1]]}function E(t){return[L(t[0]),L(t[1])]}var F={name:"x",handles:["w","e"].map(q),input:function(t,s){return null==t?null:[[+t[0],s[0][1]],[+t[1],s[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},X={name:"y",handles:["n","s"].map(q),input:function(t,s){return null==t?null:[[s[0][0],+t[0]],[s[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Y={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},H={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},O={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},I={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},P={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function q(t){return{type:t}}function N(){return!o.ctrlKey&&!o.button}function R(){var t=this.ownerSVGElement||this;return t.hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]}function U(){return navigator.maxTouchPoints||"ontouchstart"in this}function V(t){for(;!t.__brush;)if(!(t=t.parentNode))return;return t.__brush}const W=function(t,s,i,n,e,r,h,d){return function(t){var s,i=R,n=N,e=U,r=!0,h=w("start","brush","end"),d=6;function p(s){var i=s.property("__brush",M).selectAll(".overlay").data([q("overlay")]);i.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",Y.overlay).merge(i).each(function(){var t=V(this).extent;a(this).attr("x",t[0][0]).attr("y",t[0][1]).attr("width",t[1][0]-t[0][0]).attr("height",t[1][1]-t[0][1])}),s.selectAll(".selection").data([q("selection")]).enter().append("rect").attr("class","selection").attr("cursor",Y.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var n=s.selectAll(".handle").data(t.handles,function(t){return t.type});n.exit().remove(),n.enter().append("rect").attr("class",function(t){return"handle handle--"+t.type}).attr("cursor",function(t){return Y[t.type]}),s.each(g).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",b).filter(e).on("touchstart.brush",b).on("touchmove.brush",_).on("touchend.brush touchcancel.brush",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(){var t=a(this),s=V(this).selection;s?(t.selectAll(".selection").style("display",null).attr("x",s[0][0]).attr("y",s[0][1]).attr("width",s[1][0]-s[0][0]).attr("height",s[1][1]-s[0][1]),t.selectAll(".handle").style("display",null).attr("x",function(t){return"e"===t.type[t.type.length-1]?s[1][0]-d/2:s[0][0]-d/2}).attr("y",function(t){return"s"===t.type[0]?s[1][1]-d/2:s[0][1]-d/2}).attr("width",function(t){return"n"===t.type||"s"===t.type?s[1][0]-s[0][0]+d:d}).attr("height",function(t){return"e"===t.type||"w"===t.type?s[1][1]-s[0][1]+d:d})):t.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function m(t,s,i){return!i&&t.__brush.emitter||new v(t,s)}function v(t,s){this.that=t,this.args=s,this.state=t.__brush,this.active=0}function b(){if((!s||o.touches)&&n.apply(this,arguments)){var i,e,h,l,u,d,p,w,v,b,_,x,M=this,k=o.target.__data__.type,D="selection"===(r&&o.metaKey?k="overlay":k)?T:r&&o.altKey?B:z,S=t===X?null:I[k],L=t===F?null:P[k],E=V(M),q=E.extent,N=E.selection,R=q[0][0],U=q[0][1],W=q[1][0],G=q[1][1],J=0,K=0,Q=S&&L&&r&&o.shiftKey,Z=o.touches?(x=o.changedTouches[0].identifier,function(t){return c(t,o.touches,x)}):f,tt=Z(M),st=tt,it=m(M,arguments,!0).beforestart();"overlay"===k?(N&&(v=!0),E.selection=N=[[i=t===X?R:tt[0],h=t===F?U:tt[1]],[u=t===X?W:i,p=t===F?G:h]]):(i=N[0][0],h=N[0][1],u=N[1][0],p=N[1][1]),e=i,l=h,d=u,w=p;var nt=a(M).attr("pointer-events","none"),et=nt.selectAll(".overlay").attr("cursor",Y[k]);if(o.touches)it.moved=ht,it.ended=at;else{var rt=a(o.view).on("mousemove.brush",ht,!0).on("mouseup.brush",at,!0);r&&rt.on("keydown.brush",function(){switch(o.keyCode){case 16:Q=S&&L;break;case 18:D===z&&(S&&(u=d-J*S,i=e+J*S),L&&(p=w-K*L,h=l+K*L),D=B,ot());break;case 32:D!==z&&D!==B||(S<0?u=d-J:S>0&&(i=e-J),L<0?p=w-K:L>0&&(h=l-K),D=j,et.attr("cursor",Y.selection),ot());break;default:return}A()},!0).on("keyup.brush",function(){switch(o.keyCode){case 16:Q&&(b=_=Q=!1,ot());break;case 18:D===B&&(S<0?u=d:S>0&&(i=e),L<0?p=w:L>0&&(h=l),D=z,ot());break;case 32:D===j&&(o.altKey?(S&&(u=d-J*S,i=e+J*S),L&&(p=w-K*L,h=l+K*L),D=B):(S<0?u=d:S>0&&(i=e),L<0?p=w:L>0&&(h=l),D=z),et.attr("cursor",Y[k]),ot());break;default:return}A()},!0),function(t){var s=t.document.documentElement,i=a(t).on("dragstart.drag",C,!0);"onselectstart"in s?i.on("selectstart.drag",C,!0):(s.__noselect=s.style.MozUserSelect,s.style.MozUserSelect="none")}(o.view)}$(),y(M),g.call(M),it.start()}function ht(){var t=Z(M);!Q||b||_||(Math.abs(t[0]-st[0])>Math.abs(t[1]-st[1])?_=!0:b=!0),st=t,v=!0,A(),ot()}function ot(){var t;switch(J=st[0]-tt[0],K=st[1]-tt[1],D){case j:case T:S&&(J=Math.max(R-i,Math.min(W-u,J)),e=i+J,d=u+J),L&&(K=Math.max(U-h,Math.min(G-p,K)),l=h+K,w=p+K);break;case z:S<0?(J=Math.max(R-i,Math.min(W-i,J)),e=i+J,d=u):S>0&&(J=Math.max(R-u,Math.min(W-u,J)),e=i,d=u+J),L<0?(K=Math.max(U-h,Math.min(G-h,K)),l=h+K,w=p):L>0&&(K=Math.max(U-p,Math.min(G-p,K)),l=h,w=p+K);break;case B:S&&(e=Math.max(R,Math.min(W,i-J*S)),d=Math.max(R,Math.min(W,u+J*S))),L&&(l=Math.max(U,Math.min(G,h-K*L)),w=Math.max(U,Math.min(G,p+K*L)))}d<e&&(S*=-1,t=i,i=u,u=t,t=e,e=d,d=t,k in H&&et.attr("cursor",Y[k=H[k]])),w<l&&(L*=-1,t=h,h=p,p=t,t=l,l=w,w=t,k in O&&et.attr("cursor",Y[k=O[k]])),E.selection&&(N=E.selection),b&&(e=N[0][0],d=N[1][0]),_&&(l=N[0][1],w=N[1][1]),N[0][0]===e&&N[0][1]===l&&N[1][0]===d&&N[1][1]===w||(E.selection=[[e,l],[d,w]],g.call(M),it.brush())}function at(){if($(),o.touches){if(o.touches.length)return;s&&clearTimeout(s),s=setTimeout(function(){s=null},500)}else!function(t,s){var i=t.document.documentElement,n=a(t).on("dragstart.drag",null);s&&(n.on("click.drag",C,!0),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in i?n.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}(o.view,v),rt.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);nt.attr("pointer-events","all"),et.attr("cursor",Y.overlay),E.selection&&(N=E.selection),(N[0][0]===N[1][0]||N[0][1]===N[1][1])&&(E.selection=null,g.call(M)),it.end()}}function _(){m(this,arguments).moved()}function x(){m(this,arguments).ended()}function M(){var s=this.__brush||{selection:null};return s.extent=E(i.apply(this,arguments)),s.dim=t,s}return p.move=function(s,i){s.selection?s.on("start.brush",function(){m(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){m(this,arguments).end()}).tween("brush",function(){var s=this,n=s.__brush,e=m(s,arguments),r=n.selection,h=t.input("function"==typeof i?i.apply(this,arguments):i,n.extent),o=l(r,h);function a(t){n.selection=1===t&&null===h?null:o(t),g.call(s),e.brush()}return null!==r&&null!==h?a:a(1)}):s.each(function(){var s=this,n=arguments,e=s.__brush,r=t.input("function"==typeof i?i.apply(s,n):i,e.extent),h=m(s,n).beforestart();y(s),e.selection=null===r?null:r,g.call(s),h.start().brush().end()})},p.clear=function(t){p.move(t,null)},v.prototype={beforestart:function(){return 1==++this.active&&(this.state.emitter=this,this.starting=!0),this},start:function(){return this.starting?(this.starting=!1,this.emit("start")):this.emit("brush"),this},brush:function(){return this.emit("brush"),this},end:function(){return 0==--this.active&&(delete this.state.emitter,this.emit("end")),this},emit:function(s){u(new S(p,s,t.output(this.state.selection)),h.apply,h,[s,this.that,this.args])}},p.extent=function(t){return arguments.length?(i="function"==typeof t?t:D(E(t)),p):i},p.filter=function(t){return arguments.length?(n="function"==typeof t?t:D(!!t),p):n},p.handleSize=function(t){return arguments.length?(d=+t,p):d},p.keyModifiers=function(t){return arguments.length?(r=!!t,p):r},p.on=function(){var t=h.on.apply(h,arguments);return t===h?p:t},p}(F).handleSize(e).extent([[0,0],[t-h,s-d+r/2]]).on("brush",i).on("end",n)},G=function(t,s){let i=s.select("g.brush");return i.empty()&&(i=s.append("g")).attr("class","brush"),i.call(t),i},J=function(t,s,i,n){let e=t.select("line.bottomline");e.empty()&&(e=t.append("line").attr("class","bottomline").attr("stroke-width",4).style("opacity",0).attr("pointer-events","none")),e.attr("y1",n(0)).attr("y2",n(0));let r=t.selectAll(".handle--wrapper");const h=Math.floor((s-2)/2);if(r.empty()){(r=r.data([{type:"w"},{type:"e"}]).enter().append("g").attr("class","handle--wrapper")).append("rect").attr("class","handle--custom").attr("width",s).attr("height",i).attr("rx",1).attr("ry",1);const t=r.append("g").attr("class","handle--grab");for(let n=0;n<3;n++)t.append("line").attr("transform",`translate(0 ${i/2-2})`).attr("x1",h).attr("y1",2*n).attr("x2",s-h).attr("y2",2*n).attr("class","grab-line")}return r};function K(t){const{start:s}=t.length>0?t[0]:{start:0},{end:i}=t.length>0?t[t.length-1]:{end:0};return[s,i]}function Q(t){return p(t,t=>t.value)}function Z(t){return t.every(st)}function tt(t){const s=t.every(it);return t.map((t,i)=>{const n=Object.assign({},t);return s||(n.start=i,n.end=i+1),n})}function st(t){return void 0!==t.category}function it(t){return void 0!==t.start&&void 0!==t.end}function nt(t,s){const i=[t,s].map(t=>null===t);if(i[0]!==i[1])return!1;if(i[0]&&i[1])return!0;if(t.length!==s.length)return!0;const n=t.every(st),e=t.every(it);for(let i=0;i<t.length;i++){if(e&&(s[i].start!==t[i].start||s[i].end!==t[i].end))return!1;if(n&&s[i].category!==t[i].category)return!1}return!0}const et={getLowerBounds:Q,getXDomain:K,getXScale:function(t,s){return d().domain(t).range([0,s])},getYDomain:function(t){return[Math.min(0,Q(t)),g(t,t=>t.value)]},isBackgroundCompatible:nt,isCategoricalData:Z,prepareData:tt},rt=m(".2~s"),ht=m(".2");function ot(t,s){return s}function at(t){return t>0&&t<1?ht(t):rt(t)}const lt={cleanAxes:function(t){t.select(".domain").remove()},conditionalFormatter:at,generateYScale:function(t,s,i,n,e){if(!t||!t.node())return;const r=t.node().getBoundingClientRect().height-n,h=t.node().getBoundingClientRect().width-i,o=void 0!==e.ticks?e.ticks:5,a=void 0!==e.padding?e.padding:10,l=d().domain(s).range([r,0]);return b(l).tickSize(-h).ticks(o).tickPadding(a).tickFormat(e.format||at).tickValues(e.values||null)},renderBars:function(t,s,i,n,e,r,h,o=!1,a=""){if(!i||!i.node())return;let l=1;const u=i.node().getBoundingClientRect().height-h,c=i.node().getBoundingClientRect().width-r,f=0===(t=null===t?[]:t).length?c:c/t.length;f-l<3&&(l=0),this.bars=n.selectAll(`rect.${a}`).data(t),this.bars.exit().remove().transition().duration(200);const d=this.bars.enter().append("rect").attr("y",u).attr("height",0).merge(this.bars).attr("class",`bar ${a}`).attr("x",(t,s)=>s*f).attr("width",()=>Math.max(0,f-l)).style("fill",t=>t.color||e),p=s.domain()[0],g=s(Math.max(0,p));(o?d:d.transition().delay(ot)).attr("height",t=>Math.abs(s(t.value)-g)).attr("y",t=>t.value>0?s(t.value):g),(o?this.bars:this.bars.transition().delay(ot)).attr("height",t=>Math.abs(s(t.value)-g)).attr("y",t=>t.value>0?s(t.value):g)},renderPlot:function(t){if(t.select(".plot").empty()){const s=t.append("g");return s.attr("class","plot"),s}return t.select(".plot")},renderXAxis:function(t,s,i,n,e,r=at,h){if(!t||!t.node())return;const o=t.node().getBoundingClientRect().height-e,a=t.node().getBoundingClientRect().width-n,l=[0,i/2,i],u=void 0!==h.padding?h.padding:13,c=void 0!==h.ticks?h.ticks:l.length,f=d().domain([0,i]).range([0,a]),p=d().domain(s).range([0,i]);let g;if(h.values||h.format){const t=d().domain(s).range([0,a]);g=v(t).tickValues(h.values||null).tickFormat(h.format||r)}else g=v(f).tickValues(void 0!==c?null:l).tickFormat(t=>{const s=p.invert(t);return r(s)});return g.tickSize(-o).tickPadding(u).ticks(c),t.select(".x-axis").empty()?t.append("g").attr("class","x-axis").attr("transform",`translate(0, ${o})`).call(g):t.select(".x-axis").attr("transform",`translate(0, ${o})`).call(g),t.selectAll(".x-axis text").attr("transform",(t,s,i)=>{const n=i[s],{width:e}=n.getBoundingClientRect();let r=0;return 0===s?r=e/2:s===i.length-1&&(r=-e/2),`translate(${r})`}).attr("opacity",(t,s,i)=>{if(0===s||s===i.length-1)return 1;let n=0;const e=i;for(const t of e)n+=t.getBoundingClientRect().width;return a-n<0?0:1}),g},renderYAxis:function(t,s,i){t&&t.node()&&(t.select(".y-axis").empty()?t.append("g").attr("class","y-axis").call(s):t.select(".y-axis").call(s),t.select(".y-axis").append("g").attr("class","tick").attr("opacity","1").attr("transform",`translate(0,${s.scale()(0)})`).append("line").attr("shape-rendering","crisp").attr("stroke","#000").attr("class","zero").attr("x2",t.node().getBoundingClientRect().width-i))},updateAxes:function(t,s,i,n,e,r,h){const o=t.select(".xAxis"),a=t.select(".yAxis");i.domain(h).nice(),s.domain(r),o.call(n),a.call(e)}};function ut(t,s){return null===t||s>=t[0]&&s<t[1]}function ct(t,s,i,n,e,r){t.selectAll(`rect.${n}`).each((t,n,h)=>{const o=a(h[n]),l=h[n].getBoundingClientRect();l.left<=s&&s<=l.right&&l.top<=i&&i<=l.bottom?e(t,o,n,l):r&&r(t,o,n,null)})}const ft=function(t,s,i,n,e,r,a,l){t.on("mousemove",()=>{const t=o,{clientX:u,clientY:c}=t;let f=!1;ct(s,u,c,l,async(s,o,l,u)=>{let c=ut(i.selection,l)?s.color||n:e;c=h(-.16,c),o.style("fill",c);const d=await r(s);a(d,u,t),f=!0},(t,s,r)=>{const h=ut(i.selection,r);s.style("fill",h?t.color||n:e)}),f||a(null,null)}).on("click",()=>{const t=o,{clientX:n,clientY:e}=t;ct(s,n,e,l,t=>{i.setSelection([t.start,t.end],!0)})}).on("mouseleave",()=>{a(null,null),s.selectAll(`rect.${l}`).style("fill",(t,s)=>ut(i.selection,s)?t.color||n:e)})},dt=class{constructor(i){t(this,i),this.showHeader=!0,this.disableInteractivity=!1,this.data=[],this.backgroundData=null,this.color=_,this.unselectedColor=x,this.tooltipFormatter=this.formatter,this.isLoading=!1,this.error="",this.errorDescription="",this.noDataHeaderMessage="NO DATA AVAILABLE",this.noDataBodyMessage="There is no data to display.",this.responsive=!0,this.clearText="Clear selection",this.selectedFormatter=this._selectionFormatter,this.range=null,this.disableAnimation=!1,this.xAxisOptions={},this.yAxisOptions={},this.selection=null,this.tooltip=null,this._firstDataSupplied=!1,this._muteSelectionChanged=!1,this._lastEmittedSelection=null,this.selectionEmpty=!0,this.selectionFooter="",this._resizeRender=this._resizeRender.bind(this),this._setTooltip=this._setTooltip.bind(this),this.selectionChanged=s(this,"selectionChanged",7),this.selectionInput=s(this,"selectionInput",7),this.drawParametersChanged=s(this,"drawParametersChanged",7)}_onBackgroundDataChanged(t){null!==t&&0!==t.length?nt(this.data,t)&&this._prepareData(this.data,t):this._prepareData(this.data,null)}_onDataChanged(t,s){this.onNewData(t,s),this._firstDataSupplied||(this._firstDataSupplied=Boolean(t&&t.length))}onNewData(t,s){this._lastEmittedSelection=null,nt(t,this.backgroundData)?this._prepareData(this.data,this.backgroundData,s):this._prepareData(this.data,null,s)}_prepareData(t,s,i){this._data=tt(t),this._backgroundData=null===s?this._mockBackgroundData(t):tt(s);const n=function(t){return d().domain(K(t)).range([0,t.length])}(this._data),e=!!this.isCategoricalData;this.isCategoricalData=Z(this._data),this.selection=e!==this.isCategoricalData?null:this._preadjustSelection(i,n,t.length),this.binsScale=n,this._muteSelectionChanged=!0,this._dataJustChanged=!0}_onColorChanged(t){this._color=this._toColor(t||_,M)}_onSelectedColorChanged(t){this._barBackgroundColor=this._toColor(t||x,k)}async defaultFormatter(t){return this.formatter(t)}async getSelection(){const t=this._dataForSelection(this.selection);return this._simplifySelection(t)}async setSelection(t,s=!1){if(null===t)return this._setSelection(null),void this.emitSelection(this.selectionChanged,this.selection);if(t.some(t=>"string"==typeof t))return;const i=t.map(this.binsScale);this._setSelection(i),!s&&this._muteSelectionChanged||this.emitSelection(this.selectionChanged,this.selection)}async clearSelection(){this.setSelection(null)}async xFormatter(t){return this._xFormatter(t)}componentDidLoad(){this._color=this._toColor(this.color,M),this._barBackgroundColor=this._toColor(this.unselectedColor,k),this._hasDataToDisplay()&&(this.isCategoricalData=Z(this._data),requestAnimationFrame(()=>{this._renderGraph()}))}componentDidUpdate(){this._dataJustChanged&&(this._renderGraph(),this._dataJustChanged=!1)}componentWillLoad(){addEventListener("resize",this._resizeRender),this._firstDataSupplied=Boolean(this.data&&this.data.length),this.selectionFooter=this.selectedFormatter(this.selection),this._onBackgroundDataChanged(this.backgroundData),this.onNewData(this.data,null)}componentDidUnload(){removeEventListener("resize",this._resizeRender)}render(){return this._isLoading()?i("as-histogram-widget-placeholder",null,this._renderHeader()):[this._renderHeader(),this._renderSelection(),this._renderContent()]}_resizeRender(){requestAnimationFrame(()=>{this._renderGraph()})}_renderContent(){const t={"as-histogram-widget--categorical":this.isCategoricalData,"as-histogram-widget__wrapper":!0,"as-histogram-widget__wrapper--disabled":this.disableInteractivity},s={figure:!0,"figure--has-x-label":!!this.xLabel,"figure--has-y-label":!!this.yLabel};return e(this._isLoading(),this.error,this._isEmpty(),this.heading,this.errorDescription,this.noDataBodyMessage,i("div",{class:t},i("svg",{class:s,ref:t=>this.container=a(t)}),this._renderLabels(),this._renderTooltip()))}_mockBackgroundData(t){const s=et.getLowerBounds(t);return t.map(t=>Object.assign({},t,{value:Math.max(0,s)}))}_selectionFormatter(t){if(null===t)return"All selected";if(this.isCategoricalData)return`${t[1]-t[0]} selected`;let s;return`Selected from ${(s=t.map(this.binsScale.invert).map(this.axisFormatter?this.axisFormatter:t=>`${at(t)}`))[0]} to ${s[1]}`}_renderSelection(){return this._isLoading()||this._isEmpty()||this.error||!this.showClear?"":i("as-widget-selection",{selection:this.selectionFooter,clearText:this.clearText,showClear:!this.selectionEmpty,onClear:()=>this.clearSelection()})}_renderGraph(){if(!this.container||!this.container.node())return;const t=this.container.node().getBoundingClientRect(),s=void 0===this.prevWidth||void 0===this.prevHeight;this.prevWidth=this.width,this.prevHeight=this.height,this.width=t.width,this.height=t.height;const i=!s&&(this.prevWidth!==this.width||this.height!==this.prevHeight);0!==this.height&&0!==this.width&&(this._generateYAxis(),this._renderXAxis(),this.barsContainer=lt.renderPlot(this.container),ft(this.container,this.barsContainer,this,this._color,this._barBackgroundColor,t=>this.tooltipFormatter(t),this._setTooltip,"foreground-bar"),lt.renderBars(this._backgroundData,this.yScale,this.container,this.barsContainer,this._barBackgroundColor,38+(this.yLabel?25:0),40,this.disableAnimation||i,"background-bar"),lt.renderBars(this._data,this.yScale,this.container,this.barsContainer,this._color,38+(this.yLabel?25:0),40,this.disableAnimation||i,"foreground-bar"),lt.renderYAxis(this.container,this.yAxis,38),this.disableInteractivity||(this.brush=W(this.width,this.height,this._onBrush.bind(this),this._onBrushEnd.bind(this),8,20,38+(this.yLabel?25:0),40),this.brushArea=G(this.brush,this.container),this.customHandles=J(this.brushArea,8,20,this.yScale)),this._updateSelection(),this.drawParametersChanged.emit({binsScale:this.binsScale,container:this.container,handleWidth:8,height:this.height,padding:[38+(this.yLabel?25:0),40],width:this.width,xScale:this.xScale}),this._muteSelectionChanged=!1)}_setTooltip(t,s){null!==t?(this.tooltip=t,this._showTooltip(s)):this._hideTooltip()}_updateSelection(){null===this.selection||this.disableInteractivity||(this._selectionInData(this.selection)?this._setSelection(this.selection):this.clearSelection())}_adjustSelection(t){return null===t?null:t.map(t=>this._adjustSelectionValue(t))}_adjustSelectionValue(t){return t<0?0:t>=this._data.length?this._data.length:Math.round(t)}_hideCustomHandles(){this.customHandles.style("opacity",0),this.brushArea.selectAll(".bottomline").style("opacity",0)}_onBrush(){if(this.disableInteractivity)return;const t=o;if(null===t.selection)return void this._hideCustomHandles();if(!t.sourceEvent||"brush"===t.sourceEvent.type)return;const s=t.selection.map(t=>this.xScale.invert(t));this._setSelection(s)}_onBrushEnd(){this.disableInteractivity||this._muteSelectionChanged||this.emitSelection(this.selectionChanged,this.selection)}_setSelection(t){if(this.disableInteractivity)return;const s=this._adjustSelection(t);if(null!==s&&s[0]===s[1])return;const i=null!==this.selection&&null!==s&&this.selection.every((t,i)=>s[i]===t);this.selection=s,this._updateHandles(s),i||(this._hideTooltip(),this.emitSelection(this.selectionInput,this.selection)),this.selectionEmpty=null===this.selection,this.selectionFooter=this.selectedFormatter(this.selection)}_preadjustSelection(t,s,i){if(!t||!this.selection)return this.selection;if(this.isCategoricalData){const s=this._simplifySelection(this._dataForSelection(this.selection,t)).map(t=>this._data.findIndex(s=>s.category===t));return s.some(t=>-1===t)?null:[s[0],s[s.length-1]+1]}const n=this._simplifySelection(this._dataForSelection(this.selection,t)).map(s).map(Math.round);return[Math.max(0,n[0]),Math.min(i,n[1])]}_dataForSelection(t,s){if(null===t)return null;const i=void 0!==s?s:this.data;return this.isCategoricalData?i.slice(t[0],t[1]).map(t=>t):[i[t[0]],i[t[1]-1]]}_simplifySelection(t){return null===t?null:this.isCategoricalData?t.map(t=>t.category):[t[0].start,t[t.length-1].end]}_sameSelection(t,s){return null!==t&&null!==s&&t[0]===s[0]&&t[1]===s[1]}emitSelection(t,s){if(this._sameSelection(s,this._lastEmittedSelection))return;if(null===s)return void t.emit(null);const i=this._dataForSelection(s),n={payload:i,selection:this._simplifySelection(i),type:this._eventType()};t.emit(n),t===this.selectionChanged&&(this._lastEmittedSelection=[s[0],s[1]])}_eventType(){return this.isCategoricalData?"categorical":"continuous"}_selectionInData(t){return t.map(this.binsScale.invert).map(t=>this._data.some(s=>t>=s.start&&t<=s.end)).some(t=>t)}_updateHandles(t){if(!this.xScale)return;if(null===t)return this.barsContainer.selectAll("rect.foreground-bar").style("fill",(t,s)=>this._data[s].color||this._color),void this.brushArea.call(this.brush.move,null);const s=this.yScale(this.yScale.domain()[0]),i=t.map(this.xScale);this.brushArea.call(this.brush.move,i),this.customHandles.style("opacity",1).attr("transform",(t,n)=>`translate(${i[n]-4-1},${s-10})`),this.brushArea.selectAll(".bottomline").style("opacity",1).attr("stroke-width",2).attr("x1",i[0]).attr("x2",i[1]),this.barsContainer.selectAll("rect.foreground-bar").style("fill",(s,i)=>{const n=this._data[i];if(n)return i<t[0]||i>=t[1]?this._barBackgroundColor:n.color||this._color})}_dataForDomain(){return Math.max.apply(window,this._data.map(t=>t.value))>Math.max.apply(window,this._backgroundData.map(t=>t.value))?this._data:this._backgroundData}_generateYAxis(){const t=null!==this.range?this.range:et.getYDomain(this._dataForDomain());this.yAxis=lt.generateYScale(this.container,t,38+(this.yLabel?25:0),40,this.yAxisOptions),this.yScale=this.yAxis.scale()}_renderXAxis(){const t=et.getXDomain(this._data),s=lt.renderXAxis(this.container,t,this._data.length,38+(this.yLabel?25:0),40,this.axisFormatter,this.xAxisOptions);this.xScale=s.scale()}_showTooltip(t){this.tooltipElement&&a(this.tooltipElement).style("display","inline").style("left",`${t.left+t.width/2}px`).style("top",`${t.top}px`)}_hideTooltip(){a(this.tooltipElement).style("display","none")}_renderHeader(){if(this.showHeader)return i("as-widget-header",{header:this.heading,subheader:this.description,"is-loading":this._isLoading(),"is-empty":this._isEmpty(),error:this.error,"no-data-message":this.noDataHeaderMessage})}_renderTooltip(){return i("span",{ref:t=>this.tooltipElement=t,role:"tooltip",class:"as-tooltip as-tooltip--top"},this._parseTooltip(this.tooltip))}_parseTooltip(t){return null===t?null:Array.isArray(t)?t.map(t=>this._renderTooltipLine(t)):this._renderTooltipLine(t)}_renderTooltipLine(t){return i("div",null,t)}_renderLabels(){return[this.yLabel?i("div",{class:"y-label"},this.yLabel):"",this.xLabel?i("div",{class:"x-label"},this.xLabel):""]}_toColor(t,s){if(t.startsWith("var(")){const i=t.match(/var\(([^,\)]+)(,.+)?\)/);if(null===i)return s;const n=i[1],e=(i[2]||"").replace(",","").trim(),r=getComputedStyle(this.el).getPropertyValue(n).toLowerCase().trim();return 0===r.length?0===e.length?s:e:r}return t}_isLoading(){return(!this._firstDataSupplied||this.isLoading)&&!this.error}_isEmpty(){return this._data&&!this._data.length}_hasDataToDisplay(){return!(this._isLoading()||this._isEmpty()||this.error)}formatter(t){const s=[];return s.push(this.isCategoricalData?`${t.category}`:`${this._xFormatter(t.start)} - ${this._xFormatter(t.end)}`),s.push(`${r(t.value).trim()}`),s}_xFormatter(t){return this.axisFormatter?this.axisFormatter(t):at(t)}get el(){return n(this)}static get watchers(){return{backgroundData:["_onBackgroundDataChanged"],data:["_onDataChanged"],color:["_onColorChanged"],unselectedColor:["_onSelectedColorChanged"]}}static get style(){return".as-tooltip{--as--tooltip--background-color:var(--as--color--type-01,#2c2c2c);--as--tooltip--color:var(--as--color--text-contrast,#fff);--as--tooltip--support-color:var(--as--color--white,#fff);--as--tooltip--primary--background-color:var(--as--primary--success,#1785fb);--as--tooltip--primary--color:var(--as--tooltip--support-color);--as--tooltip--secondary--background-color:var(--as--secondary--success,#0f2d53);--as--tooltip--secondary--color:var(--as--tooltip--support-color);--as--tooltip--complementary--background-color:var(--as--complementary--success,#47db99);--as--tooltip--complementary--color:var(--as--tooltip--support-color);--as--tooltip--error--background-color:var(--as--color--error,#f3522b);--as--tooltip--error-color:var(--as--tooltip--support-color);--as--tooltip--warning--background-color:var(--as--color--warning,#fdb32b);--as--tooltip--warning--color:var(--as--tooltip--support-color);--as--tooltip--success--background-color:var(--as--color--success,#80b622);--as--tooltip--success--color:var(--as--tooltip--support-color);display:-ms-inline-flexbox;display:inline-flex;position:relative;padding:4px 8px;border-width:0;border-radius:4px;border-color:var(--as--tooltip--background-color);background:var(--as--tooltip--background-color);color:var(--as--tooltip--color);font:var(--as--font--body)}.as-tooltip:after{content:\"\";position:absolute;border-width:5px;border-style:solid;border-radius:2px;border-color:inherit}.as-tooltip--top:after{top:100%;left:50%;-webkit-transform:translateY(-6px) translateX(-5px) rotate(45deg);transform:translateY(-6px) translateX(-5px) rotate(45deg)}.as-tooltip--bot:after,.as-tooltip--bottom:after{bottom:100%;left:50%;-webkit-transform:translateY(6px) translateX(-5px) rotate(45deg);transform:translateY(6px) translateX(-5px) rotate(45deg)}.as-tooltip--right:after{top:50%;left:0;-webkit-transform:translateY(-5px) translateX(-4px) rotate(45deg);transform:translateY(-5px) translateX(-4px) rotate(45deg)}.as-tooltip--left:after{top:50%;right:0;-webkit-transform:translateY(-4px) translateX(4px) rotate(45deg);transform:translateY(-4px) translateX(4px) rotate(45deg)}.as-tooltip--primary{border-color:var(--as--tooltip--primary--background-color);background:var(--as--tooltip--primary--background-color);color:var(--as--tooltip--primary--color)}.as-tooltip--secondary{border-color:var(--as--tooltip--secondary--background-color);background:var(--as--tooltip--secondary--background-color);color:var(--as--tooltip--secondary--color)}.as-tooltip--complementary{border-color:var(--as--tooltip--complementary--background-color);background:var(--as--tooltip--complementary--background-color);color:var(--as--tooltip--complementary--color)}.as-tooltip--error{border-color:var(--as--tooltip--error--background-color);background:var(--as--tooltip--error--background-color);color:var(--as--tooltip--error--color)}.as-tooltip--warning{border-color:var(--as--tooltip--warning--background-color);background:var(--as--tooltip--warning--background-color);color:var(--as--tooltip--warning--color)}.as-tooltip--success{border-color:var(--as--tooltip--success--background-color);background:var(--as--tooltip--success--background-color);color:var(--as--tooltip--success--color)}as-histogram-widget{--as--histogram-widget--background-color:var(--as--color--ui-01,#fff);--as--histogram-widget--figure--stroke-color:var(--as--color--secondary,#0f2d53);--as--histogram-widget--figure--text-color:var(--as--color--type-01,#2c2c2c);--as--histogram-widget--label-color:var(--as--color--type-01,#2c2c2c);--as--histogram-widget--label-font:var(--as--font--caption);display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;width:100%;min-width:228px;height:100%;max-height:100%;overflow:auto;background:var(--as--histogram-widget--background-color)}as-histogram-widget as-widget-header{padding-top:6px}as-histogram-widget .as-histogram-widget__wrapper{display:-ms-flexbox;display:flex;position:relative;-ms-flex:1;flex:1;min-height:0}as-histogram-widget .as-histogram-widget--categorical .x-axis{opacity:0}as-histogram-widget .figure{-webkit-box-sizing:border-box;box-sizing:border-box;-ms-flex:1;flex:1;width:100%;min-height:0;padding:18px 8px 17px 30px;overflow:visible}as-histogram-widget .figure--has-x-label{margin-bottom:25px}as-histogram-widget .figure--has-y-label{padding-left:55px}as-histogram-widget .figure text{fill:var(--as--histogram-widget--figure--text-color)}as-histogram-widget .figure .brush .selection{stroke:none;fill:none}as-histogram-widget .figure .foreground-bar{cursor:pointer}as-histogram-widget .figure .y-axis{--widget-axis-text-color:var(--as--color--type-01,#2c2c2c);--widget-axis-line-color:var(--as--color--ui-05,#b3b3b3)}as-histogram-widget .figure .y-axis .tick text{width:30px;fill:var(--widget-axis-text-color);white-space:pre}as-histogram-widget .figure .y-axis .tick line{stroke:var(--widget-axis-line-color);opacity:.1}as-histogram-widget .figure .y-axis .tick line.zero{opacity:.5}as-histogram-widget .figure .x-axis .domain,as-histogram-widget .figure .x-axis .tick line,as-histogram-widget .figure .y-axis .domain{display:none}as-histogram-widget .figure .handle--wrapper{opacity:0}as-histogram-widget .figure .handle--custom{stroke-linecap:round;stroke:var(--as--histogram-widget--figure--stroke-color);fill:#fff;cursor:ew-resize;pointer-events:none}as-histogram-widget .figure .grab-line{stroke:#ccc}as-histogram-widget .figure .bottomline{stroke:var(--as--histogram-widget--figure--stroke-color)}as-histogram-widget .as-histogram-widget__wrapper--disabled svg .bar{cursor:inherit}as-histogram-widget .as-histogram-widget__footer{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:justify;justify-content:space-between;margin-top:8px}as-histogram-widget .as-histogram-widget__selection{margin:0}as-histogram-widget .x-label,as-histogram-widget .y-label{color:var(--as--histogram-widget--label-color);font:var(--as--histogram-widget--label-font);text-align:center}as-histogram-widget .x-label{position:absolute;bottom:0;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}as-histogram-widget .y-label{position:absolute;top:50%;left:0;margin-left:4px;-webkit-transform:rotate(-90deg) translate(-50%);transform:rotate(-90deg) translate(-50%);-webkit-transform-origin:0 0;transform-origin:0 0}as-histogram-widget [role=tooltip]{display:none;position:fixed;-webkit-transform:translate(-50%,-120%);transform:translate(-50%,-120%);pointer-events:none}"}};export{dt as as_histogram_widget};